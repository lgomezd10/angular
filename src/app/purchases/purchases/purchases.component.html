<nav>
  <a routerLink="/purchases" routerLinkActive="active">purchases</a>
  <a routerLink="/purchases-dates" routerLinkActive="active">Buscar purchases</a>
</nav>
<router-outlet></router-outlet>

<h2 class="title is-3">purchases</h2>

<!--Prueba de botones
<ul>
  <li *ngFor="let prueba of botones">{{prueba.name}}, {{prueba.mostrar}}</li>
</ul>
-->

<div class="columns">

  <div class="column is-three-quarters">
    <div class="zona-tabla">
      <table class="table is-striped">
        <thead>
          <tr>
            <th>Producto</th>
            <th>quantity</th>
            <th>price Kg</th>
            <th>price</th>
            <th *ngIf="!compraFinalizada">Eliminar</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let compra of purchases">
            <td>{{compra.producto.name}}</td>
            <td>{{compra.quantity}}</td>
            <td>{{compra.price}}</td>
            <td>{{compra.quantity * compra.price | number: '1.0-2'}}</td>
            <td *ngIf="!compraFinalizada"> <button (click)=eliminarCompra(compra)>Eliminar</button></td>
          </tr>
        </tbody>
      </table>

      <h1>Total: {{totalCompra()}}</h1>
      <br><br>
      <!--<button (click)=nuevoProducto() *ngIf ="!compraFinalizada">Nueva compra</button>-->
      <p *ngIf="compraFinalizada">Compra guardada correctamente</p>

    </div>
    
    <form *ngIf="mostrarNuevo" [formGroup]="formulario" [class.error]="!formulario.valid && formulario.touched" #elementoForm>
      
      <div class="columns">
        <div class="column">
          <label class="label">Buscar:</label>
          <input class="input" name="buscar" type="text" (keypress)="procesarKeypress($event, producto)" #buscar
            [formControl]="formulario.controls['buscar']">
          <select class="select is-multiple" id="producto" name="producto" size="5" (keypress)="procesarKeypress($event, quantity)" #producto
            [formControl]="formulario.controls['producto']">
            <option
              *ngFor="let producto of productos$| async | sort:'name' |filter: formulario.controls['buscar'].value"
              [ngValue]="producto">
              {{producto.productId}} {{producto.name}} stock: {{producto.stock}}</option>
          </select><br>
          <div class="help is-danger"
            *ngIf="!formulario.controls['producto'].valid && formulario.controls['producto'].touched">Seleccione un
            producto</div>
        </div>
        <div class="column">
          <label class="label">quantity:</label> <input class="input" type="number" id="quantity" name="quantity"
            (keypress)="procesarKeypress($event, price)" #quantity [formControl]="formulario.controls['quantity']"><br>

          <div class="help is-danger"
            *ngIf="formulario.controls['quantity'].hasError('required') && formulario.controls['quantity'].touched">
            Introduzca la quantity</div>
          <div class="help is-danger"
            *ngIf="formulario.controls['quantity'].hasError('min') && formulario.controls['quantity'].touched">La quantity
            debe ser mayor que 0</div>


          <label class="label">price: </label>
          <input class="input" type="number" id="price" name="price" min=0 (keypress)="procesarKeypress($event, enviar)" #price
            [formControl]="formulario.controls['price']">
          <div class="help is-danger"
            *ngIf="formulario.controls['price'].hasError('required') && formulario.controls['price'].touched">
            Introduzca el price</div>
          <div class="help is-danger"
            *ngIf="formulario.controls['price'].hasError('min') && formulario.controls['price'].touched">El price
            debe ser mayor que 0</div>
          <div id="enviar" #enviar></div>
        </div>
      </div>
    </form>
  
    <div class="crear-nuevo">
      <!--<button (click) = enviarCompra() *ngIf ="purchases.length > 0 && !compraFinalizada">Enviar compra</button>-->
      <app-nuevo *ngIf="mostrarNuevoProducto" (productoGuardado)="nuevoGuardado($event)"></app-nuevo>
    </div>

  </div>

  <div class="column">
    <app-lista-botones [lista]="botones" (enviarBoton)="mostrarBoton($event)"></app-lista-botones>
  </div>

</div>
<!--Class container-->