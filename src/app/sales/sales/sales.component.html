<nav>
  <a routerLink="/sales" routerLinkActive="active">sales</a>
  <a routerLink="/sales-dates" routerLinkActive="active">Buscar sales</a>
</nav>
<router-outlet></router-outlet>

<h2 class="title is-3">Caja</h2>

<input type="text" [(ngModel)]="findSale">
<button (click)=openSale(findSale)>Buscar</button>
<br><br>

<div *ngIf="codigoSale > 0 && !abierta">
  <p>Sale finalizada</p>
  <p>CÃ³digo Sale: {{codigoSale}}</p>
</div>

<div class="columns">
  <div class="column is-three-quarters">
    <div class="zona-tabla">
      <!--
      <table class="resultados">
        <tr>
          <th>Product</th>
          <th>quantity</th>
          <th>price Kg</th>
          <th>price</th>
          <th *ngIf="codigoSale == 0 || abierta">Eliminar</th>
        </tr>
        <tr *ngFor="let sale of sales">
          <td>{{sale.product.name}}</td>
          <td>{{sale.quantity}}</td>
          <td>{{sale.price}}</td>
          <td>{{sale.quantity * sale.price | number: '1.0-2'}}</td>
          <td *ngIf="codigoSale == 0 || abierta"> <button (click)=eliminarSale(sale)>Eliminar</button></td>
        </tr>
      </table>
      <h2>Total : {{total}}</h2>
      <br>

      <div *ngIf="codigoSale == 0 || abierta">
        <input type="checkbox" [(ngModel)]="creditCard" /> Pago con creditCard
      </div>
      -->
      <table class="table is-striped">
        <thead>
          <tr>
            <th>Product</th>
            <th>quantity</th>
            <th>price Kg</th>
            <th>price</th>
            <th *ngIf="codigoSale == 0 || abierta">Eliminar</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let sale of sales">
            <td>{{sale.product.name}}</td>
            <td>{{sale.quantity}}</td>
            <td>{{sale.price}}</td>
            <td>{{sale.quantity * sale.price | number: '1.0-2'}}</td>
            <td *ngIf="codigoSale == 0 || abierta"> <button (click)=eliminarSale(sale)>Eliminar</button></td>
          </tr>
        </tbody>
      </table>
      <h2>Total : {{totalSale()}}</h2>
      <br>

      <div *ngIf="codigoSale == 0 || abierta">
        <input type="checkbox" [(ngModel)]="creditCard" /> Pago con creditCard
      </div>
    </div>

    <form *ngIf="showNew" [formGroup]="formGroup" [class.error]="!formGroup.valid && formGroup.touched" #elementForm>
      
      <div class="columns">
      <div class="column">
        <label class="label">Buscar product: </label>
        <input class="input" placeholder="Buscar product" type="text"
          (keypress)="procesarKeypress($event, product)" #find [formControl]="formGroup.controls['find']" />


        <select size="5"(keypress)="procesarKeypress($event, quantity)" #product
          [formControl]="formGroup.controls['product']">
          <option
            *ngFor="let product of products$| async | sort:'name' |filter: formGroup.controls['find'].value"
            [ngValue]="product">
            {{product.id}} {{product.name}} {{product.price}}</option>
        </select>
        <div class="help is-danger"
          *ngIf="!formGroup.controls['product'].valid && formGroup.controls['product'].touched">Seleccione un
          product</div>

      </div>
      <div class="column">
        <label class="label"> quantity</label>
        <input class="input" type="number" (keypress)="procesarKeypress($event, enviar)" #quantity
          [formControl]="formGroup.controls['quantity']">
        <div class="help is-danger"
          *ngIf="formGroup.controls['quantity'].hasError('required') && formGroup.controls['quantity'].touched">
          Introduzca la quantity</div>
        <div class="help is-danger"
          *ngIf="formGroup.controls['quantity'].hasError('min') && formGroup.controls['quantity'].touched">La quantity
          debe ser mayor que 0</div>
        <div id="enviar" #enviar></div>
      </div>
    </div>
    </form>
  </div>

  <div class="column">
    <app-button-list [lista]="botones" (sendButtonType)="showButtonType($event)"></app-button-list>
  </div>

</div>